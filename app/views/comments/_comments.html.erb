<h1>Comments </h1>
<table class="table">
    <tr>
      <th class="visible-sm visible-xs"></th>

      <th><%= t('users.list.username') %></th>
      <th><%= t('users.list.comment') %></th>
      <th><%= t('users.list.last_activity') %></th>

      <% if current_user && (current_user.role == "admin" || current_user.role == "moderator") %>
      <th><%= t('users.list.moderation') %></th>
      <% else %>
      <th><%= t('users.list.moderation') %></th>
      <% end %>
    </tr>

  <% @comments.each do |comment| %>
   <tr id="c<% comment.cid %>">
      <td>
      <i class="fa fa-comment-alt"></i> 
      <% if comment.author # some legacy comments have no author %>
        <img class="img-circle" id="profile-photo" style="width:40px;margin-right:8px;border: 1px solid lightgrey;" 
        style="<% unless comment.author.user.photo_file_name %>display:none;<% end %>
        " src="<% if comment.author.user.photo %><%= comment.author.user.photo_path(:thumb) %><% end %>" />
        <a href="/profile/<%= comment.author.name %>"><%= comment.author.name %></a> 
      <% end %>
      </td>
      <td>
      <span style="color:#aaa;"><%= t('home._comments.commented') %> 
        <% if comment.parent %>
          on <a href="<%= comment.parent.path %>"><%= comment.parent.title %></a>
        <% end %>:
      </span>
      "<%= raw strip_tags(sanitize(RDiscount.new(comment.comment).to_html)).truncate(150) %>" | 
      <% if comment.parent %>
        <a href="<%= comment.parent.path %>#c<%= comment.cid %>"><%= t('home._comments.read_more') %> &raquo;</a>
      <% end %>
      </td>
    <td><%= distance_of_time_in_words(comment.created_at, Time.current, { include_seconds: false, scope: 'datetime.time_ago_in_words' }) %></td>
    <td>
     <% if current_user &. can_moderate? %>
          <a rel="tooltip" title="Mark as spam" class="btn btn-sm btn-default btn-flag-spam-<%= comment.id %>" data-confirm="Are you sure? The user will no longer be able to log in or publish, and their content will be hidden except comments." href="/admin/mark_comment_spam/<%= comment.id %>">
            <i class="fa fa-ban"></i>
          </a>
    <% else %>
          <a rel="tooltip" title="Flag as spam" class="btn btn-sm btn-default btn-flag-spam-<%= comment.id %>" href="mailto:moderators@publiclab.org?subject=Reporting+spam+on+Public+Lab&body=Hi,+I+found+this+comment+that+looks+like+spam+or+needs+to+be+moderated:+https://publiclab.org/<%= comment.parent.path %>#c<%= comment.cid %>+by+https://publiclab.org/profile/<% if comment.author %><%= comment.author.name %><% end %>+Thanks!">
            <i class="fa fa-flag"></i>
          </a>
      <% end %>
    </td>
  </tr>
  <% end %>
</table>

<%= will_paginate @comments, :renderer => BootstrapPagination::Rails %>
