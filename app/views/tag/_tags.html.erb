<p>
  <% tags.each do |tag| %>
    <% if tag.class == NodeTag %>

      <% if power_tag ^ tag.name.include?(':') # XOR operator??? %>
        <span id="tag_<%= tag.tid %>" class="label <%= label_name %>" data-toggle="popover" data-trigger="hover" data-placement="top" data-content="<p style='text-align:center;'><a href='/contributors/<%= tag.name %>'><%= Tag.tagged_node_count(tag.name) || 0 %> Notes - <%= Tag.contributors(tag.name).count %> People <br></a></p> <p style='text-align:center;font-size:12px;'><%if tag.description %><%= tag.description %> |<% end %> created by <a href='/profile/<%= tag.try(:author).try(:username) %>'><%= tag.try(:author).try(:username) %></a> <%= time_ago_in_words(Time.at(tag.date)) %> ago </p> <div style='text-align:center;'><a href='/subscribe/tag/<%= tag.name %>' style='text-decoration:none; color:white; background: #3071a9; width:150px; padding:8px;'>Follow</a><p></p></div>" data-html="true" title="<p style='text-align:center;margin:0;padding:0'><b><%= tag.name %></b></p>">
          <a class="tag-name" href="<%= "/maps" if @node.type == "map" %>/tag/<%= tag.name %>"><%= tag.name %></a>
          <% if current_user && ( current_user.uid ==  @node.uid || current_user.uid == tag.uid  || current_user.role == "admin" || current_user.role == "moderator") %>
            <% if tag.name.include? ':' %>
              <a data-confirm="This is a power tag (see https://publiclab.org/wiki/power-tags) -- and may drive a specific function on this page. Are you sure you want to delete it?" class="tag-delete" data-remote="true" href="/tag/delete/<%= @node.id %>/<%= tag.tid %>" data-tag-id="<%= tag.tid %>" data-method="delete">x</a>
            <% else %>
              <a data-confirm="Are you sure you want to delete it?" class="tag-delete" data-remote="true" href="/tag/delete/<%= @node.id %>/<%= tag.tid %>" data-tag-id="<%= tag.tid %>" data-method="delete">x</a>
            <% end %>
          <% end %>
        </span>
      <% end %>

    <% elsif tag.class == UserTag %>

        <span id="tag_<%= tag.id %>" class="label <%= label_name %>" data-toggle="popover" data-trigger="hover" data-placement="top" data-content="<a href='/contributors/<%= tag.name %>'><%= Tag.tagged_node_count(tag.name) || 0 %> Notes - <%= Tag.contributors(tag.name).count %> People <br></a>" data-html="true" title="<p style='text-align:center;margin:0;padding:0'><b><%= tag.name %></b></p>">
          <a class="tag-name" href="/tag/<%= tag.name %>"><%= tag.name %></a>
          <% if current_user && ( current_user.uid == tag.uid  || current_user.role == "admin" || current_user.role == "moderator") %>
            <a data-confirm="Are you sure you want to delete it?" class="tag-delete" data-remote="true" href="/profile/tags/delete/<%= @user.id %>?name=<%= tag.name %>" data-method="delete">x</a>
          <% end %>
        </span>

    <% end %>

  <% end %>
</p>
