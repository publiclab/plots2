<% user = user || @user # allow overriding w/ local variable %>
<ul class= "list-inline">
  <% tags.limit(2).each do |tag| %>
    <% if tag.class == NodeTag %>
      <% if power_tag ^ tag.name.include?(':') # XOR operator??? %>
         <div class = "tags_card">
           <div class="row">
             <div class="col-md-10">
               <a href="/tag/<%= tag.name%>"><h5 style="display: inline-block; text-decoration: underline; color:black;"><%= tag.name %></h5></a>
               <p style="display: inline-block; color: #808080; font-size:15px;"><a style="color: #808080;" href="/tag/<%= tag.name %>"> <%= Tag.follower_count(tag.name) %> people</a></p>
             </div>
             <div class="col-md-2">
             <a class="ellipsis dropleft" data-toggle="dropdown">&nbsp<i class="fa fa-ellipsis-h" style="color : #666; font-size:15px; float:right; margin-right:15px;"></i></a>
             <ul class="dropdown-menu" style = "font-size:15px; padding:10px;">
               <li><a href='/tag/<%= tag.name %>' style="color:black; text-decoration: underline;"><%= Tag.tagged_node_count(tag.name) || 0 %> notes</a></li>
               <li>created by <a href='/profile/<%= tag.try(:author).try(:username) %>' style="color:black; text-decoration: underline;"><%= tag.try(:author).try(:username) %></a> </li>
               <li>created <%= time_ago_in_words(Time.at(tag.date)) %> ago</li>
               <% if logged_in_as(['admin', 'moderator']) || (current_user && ( current_user.uid ==  @node.uid || current_user.uid == tag.uid)) %>
                 <% if tag.name.include? ':' %>
                   <li><a data-confirm="This is a power tag (see https://publiclab.org/wiki/power-tags) -- and may drive a specific function on this page. Are you sure you want to delete it?" class="tag-delete" data-remote="true" href="/tag/delete/<%= @node.id %>/<%= tag.tid %>" data-tag-id="<%= tag.tid %>" data-method="delete" style="color:black; text-decoration: underline;">delete tag</a></li>
                 <% else %>
                   <li><a data-confirm="Are you sure you want to delete it?" class="tag-delete" data-remote="true" href="/tag/delete/<%= @node.id %>/<%= tag.tid %>" data-tag-id="<%= tag.tid %>" data-method="delete" style="color:black; text-decoration: underline;">delete tag</a></li>
                 <% end %>
               <% end %>
             </ul>
           </div>
         </div>
           <div style="margin-left:130px; margin-top:-3px;">
             <a href='/subscribe/tag/<%= tag.name %>' class='btn btn-primary'>Subscribe</a>
           </div>
         </div>
      <% end %>


    <% elsif tag.class == UserTag && (tag.name[0..4] != "oauth" || (logged_in_as(['admin', 'moderator']) || (current_user && current_user.uid == tag.uid))) %>

        <li style="width: 100%;"><span id="tag_<%= tag.id %>" class="badge <%= badge_name %> pop" style="cursor:pointer" data-toggle="popover" data-trigger="manual" data-count=0 data-placement="top" data-content="<a href='/contributors/<%= tag.name %>'><%= Tag.tagged_node_count(tag.name) || 0 %> notes - <%= Tag.contributors(tag.name).count %> people <br></a>" data-html="true" title="<%= tag.name %>">
          <% if tag.name[0..4] != "oauth" %>
            <%= tag.name %>
          <% else %>
            <%= tag.name[0..5] + tag.name.split(':')[1] %>
          <% end %>
          <% if logged_in_as(['admin', 'moderator']) || (current_user && current_user.uid == tag.uid) %>
            <a data-confirm="Are you sure you want to delete it?" class="tag-delete" data-remote="true" href="/profile/tags/delete/<%= user.id %>?name=<%= tag.name %>" data-method="delete">x</a>
          <% end %>
        </span></li>

    <% end %>
  <% end %>
</ul>

<script type="text/javascript">

$(".pop").popover({ trigger: "manual" , html: true, animation:false})
    .on("mouseenter", function () {
        var _this = this;
        $(this).popover("show");
        $(".popover").on("mouseleave", function () {
            $(_this).popover('hide');
        });
    }).on("mouseleave", function () {
        var _this = this;
        setTimeout(function () {
            if (!$(".popover:hover").length) {
                $(_this).popover("hide");
            }
        }, 300);
});

$('.tag-delete').click(
  function(){
    $('.popover').remove();
  }
);

</script>

<style>
  .tags_card{
    width: 250px;
    height:auto;
    border: 1px solid #ccc;
    border-radius: 12px;
    margin-top: 10px;
    padding-left: 12px;
    padding-top: 14px;
    padding-bottom: 10px;
  }

  .ellipsis{
    cursor: pointer;
  }

</style>
