<style>
#cytoscape {
  width: 100%;
  height: 400px;
  display: block;
}
</style>

<script src="/lib/cytoscape/dist/cytoscape.min.js" type="text/javascript"></script>

<div id="cytoscape"></div>

<script>
  var cy;

  jQuery(document).ready(function() {

  $.ajax({
    url : '/tag/graph.json',
    type: 'GET',
    success: function(response){
      setup_cytoscape(response);
    }
  });

  function parse_cyto_data(data) {
    var output = {
      nodes: [],
      edges: []
    }

    data['tags'].forEach(function(tagname) {
      output.nodes.push({ data: { id: tagname } });
    });
    data['edges'].forEach(function(edge) {
      output.edges.push({ data: { id: edge.from + "_" + edge.to, source: edge.from, target: edge.to } });
    });
    return output;
  }

  function setup_cytoscape(data) {

    var data = parse_cyto_data(data);

    cy = cytoscape({
      container: document.getElementById('cytoscape'),
      elements: {
        nodes: data.nodes,
        edges: data.edges
      },

      layout: 'cose',
      animate: true,
  
      // The layout animates only after this many milliseconds for animate:true
      // (prevents flashing on fast runs)
      animationThreshold: 250,
  
      // Number of iterations between consecutive screen positions update
      refresh: 20,
  
  
      // Whether to fit the network view after when done
      fit: true,
  
      // Padding on fit
      padding: 30,

      // so we can see the ids
      style: [
        {
          selector: 'node',
          style: {
            'label': 'data(id)'
          }
        }
      ]
    });

    // cy.nodes().forEach(function(node) { node.style('width', '100px') })

  }

});

</script>
