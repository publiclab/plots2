<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">

<title>class Node - Rails Application Documentation</title>

<script type="text/javascript">
var rdoc_rel_prefix = './';
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>



  <div id="class-metadata">

    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>


  <p class="link">ActiveRecord::Base

</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">


    <li><a class="include" href="NodeShared.html">NodeShared</a>


  </ul>
</div>


    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">

    <li ><a href="#method-c-activities">::activities</a>

    <li ><a href="#method-c-find_by_path">::find_by_path</a>

    <li ><a href="#method-c-find_map">::find_map</a>

    <li ><a href="#method-c-find_notes">::find_notes</a>

    <li ><a href="#method-c-find_wiki">::find_wiki</a>

    <li ><a href="#method-c-inheritance_column">::inheritance_column</a>

    <li class="calls-super" ><a href="#method-c-instance_method_already_implemented-3F">::instance_method_already_implemented?</a>

    <li ><a href="#method-c-like">::like</a>

    <li ><a href="#method-c-new_node">::new_node</a>

    <li ><a href="#method-c-new_note">::new_note</a>

    <li ><a href="#method-c-new_wiki">::new_wiki</a>

    <li ><a href="#method-c-questions">::questions</a>

    <li ><a href="#method-c-research_notes">::research_notes</a>

    <li ><a href="#method-c-search">::search</a>

    <li ><a href="#method-c-unlike">::unlike</a>

    <li ><a href="#method-c-upgrades">::upgrades</a>

    <li ><a href="#method-c-weekly_tallies">::weekly_tallies</a>

    <li ><a href="#method-i-activities">#activities</a>

    <li ><a href="#method-i-add_barnstar">#add_barnstar</a>

    <li ><a href="#method-i-add_comment">#add_comment</a>

    <li ><a href="#method-i-add_tag">#add_tag</a>

    <li ><a href="#method-i-answered">#answered</a>

    <li ><a href="#method-i-author">#author</a>

    <li ><a href="#method-i-authors">#authors</a>

    <li ><a href="#method-i-barnstar">#barnstar</a>

    <li ><a href="#method-i-barnstars">#barnstars</a>

    <li ><a href="#method-i-body">#body</a>

    <li ><a href="#method-i-body_preview">#body_preview</a>

    <li ><a href="#method-i-can_tag">#can_tag</a>

    <li ><a href="#method-i-coauthors">#coauthors</a>

    <li ><a href="#method-i-comment_count">#comment_count</a>

    <li ><a href="#method-i-created_at">#created_at</a>

    <li ><a href="#method-i-drupal_content_field_image_gallery">#drupal_content_field_image_gallery</a>

    <li ><a href="#method-i-drupal_main_image">#drupal_main_image</a>

    <li ><a href="#method-i-edit_path">#edit_path</a>

    <li ><a href="#method-i-files">#files</a>

    <li ><a href="#method-i-gallery">#gallery</a>

    <li ><a href="#method-i-generate_path">#generate_path</a>

    <li ><a href="#method-i-get_matching_tags_without_aliasing">#get_matching_tags_without_aliasing</a>

    <li ><a href="#method-i-has_accepted_answers">#has_accepted_answers</a>

    <li ><a href="#method-i-has_mailing_list-3F">#has_mailing_list?</a>

    <li ><a href="#method-i-has_power_tag">#has_power_tag</a>

    <li ><a href="#method-i-has_tag">#has_tag</a>

    <li ><a href="#method-i-has_tag_without_aliasing">#has_tag_without_aliasing</a>

    <li ><a href="#method-i-icon">#icon</a>

    <li ><a href="#method-i-id">#id</a>

    <li ><a href="#method-i-is_liked_by">#is_liked_by</a>

    <li ><a href="#method-i-lat">#lat</a>

    <li ><a href="#method-i-latest">#latest</a>

    <li ><a href="#method-i-likers">#likers</a>

    <li ><a href="#method-i-lon">#lon</a>

    <li ><a href="#method-i-mailing_list">#mailing_list</a>

    <li ><a href="#method-i-main_image">#main_image</a>

    <li ><a href="#method-i-map">#map</a>

    <li ><a href="#method-i-mentioned_users">#mentioned_users</a>

    <li ><a href="#method-i-new_revision">#new_revision</a>

    <li ><a href="#method-i-next_by_author">#next_by_author</a>

    <li ><a href="#method-i-node_tags">#node_tags</a>

    <li ><a href="#method-i-normal_tags">#normal_tags</a>

    <li ><a href="#method-i-notify">#notify</a>

    <li ><a href="#method-i-path">#path</a>

    <li ><a href="#method-i-power_tag">#power_tag</a>

    <li ><a href="#method-i-power_tag_objects">#power_tag_objects</a>

    <li ><a href="#method-i-power_tags">#power_tags</a>

    <li ><a href="#method-i-prev_by_author">#prev_by_author</a>

    <li ><a href="#method-i-publish">#publish</a>

    <li ><a href="#method-i-questions">#questions</a>

    <li ><a href="#method-i-replace">#replace</a>

    <li ><a href="#method-i-responded_to">#responded_to</a>

    <li ><a href="#method-i-response_count">#response_count</a>

    <li ><a href="#method-i-responses">#responses</a>

    <li ><a href="#method-i-revision_count">#revision_count</a>

    <li ><a href="#method-i-revisions">#revisions</a>

    <li ><a href="#method-i-slug_from_path">#slug_from_path</a>

    <li ><a href="#method-i-spam">#spam</a>

    <li ><a href="#method-i-subscribers">#subscribers</a>

    <li ><a href="#method-i-tagged_lat">#tagged_lat</a>

    <li ><a href="#method-i-tagged_lon">#tagged_lon</a>

    <li ><a href="#method-i-tagnames">#tagnames</a>

    <li ><a href="#method-i-tagnames_as_classes">#tagnames_as_classes</a>

    <li ><a href="#method-i-tags">#tags</a>

    <li ><a href="#method-i-toggle_like">#toggle_like</a>

    <li ><a href="#method-i-totalviews">#totalviews</a>

    <li ><a href="#method-i-updated_at">#updated_at</a>

    <li ><a href="#method-i-updated_month">#updated_month</a>

    <li ><a href="#method-i-upgrades">#upgrades</a>

  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Node">
  <h1 id="class-Node" class="class">
    class Node
  </h1>

  <section class="description">

  </section>




  <section id="5Buntitled-5D" class="documentation-section">









     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>


      <div id="method-c-activities" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">activities</span><span
            class="method-args">(tagname)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>so we can call <a
href="Node.html#method-i-activities">#activities</a>(&#39;balloon-mapping&#39;)</p>




          <div class="method-source-code" id="activities-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 752</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">activities</span>(<span class="ruby-identifier">tagname</span>)
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;note&#39;</span>)
      .<span class="ruby-identifier">includes</span>(<span class="ruby-value">:revision</span>, <span class="ruby-value">:tag</span>)
      .<span class="ruby-identifier">references</span>(<span class="ruby-value">:term_data</span>)
      .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;term_data.name LIKE ?&#39;</span>, <span class="ruby-node">&quot;activity:#{tagname}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-find_by_path" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">find_by_path</span><span
            class="method-args">(title)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="find_by_path-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 462</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_by_path</span>(<span class="ruby-identifier">title</span>)
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">path</span><span class="ruby-operator">:</span> [<span class="ruby-node">&quot;/#{title}&quot;</span>]).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-find_map" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">find_map</span><span
            class="method-args">(name, date)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="find_map-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 694</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_map</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">date</span>)
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">path</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;/map/#{name}/#{date}&quot;</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-find_notes" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">find_notes</span><span
            class="method-args">(author, date, title)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="find_notes-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 690</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_notes</span>(<span class="ruby-identifier">author</span>, <span class="ruby-identifier">date</span>, <span class="ruby-identifier">title</span>)
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">path</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;/notes/#{author}/#{date}/#{title}&quot;</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-find_wiki" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">find_wiki</span><span
            class="method-args">(title)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="find_wiki-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 698</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_wiki</span>(<span class="ruby-identifier">title</span>)
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">path</span><span class="ruby-operator">:</span> [<span class="ruby-node">&quot;/#{title}&quot;</span>, <span class="ruby-node">&quot;/tool/#{title}&quot;</span>, <span class="ruby-node">&quot;/wiki/#{title}&quot;</span>, <span class="ruby-node">&quot;/place/#{title}&quot;</span>]).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-inheritance_column" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">inheritance_column</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>making drupal and rails database conventions play nice; &#39;type&#39; is a
reserved word in rails</p>




          <div class="method-source-code" id="inheritance_column-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 67</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inheritance_column</span>
  <span class="ruby-string">&#39;rails_type&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-instance_method_already_implemented-3F" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">instance_method_already_implemented?</span><span
            class="method-args">(method_name)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">




            <div class="method-calls-super">
              Calls superclass method

            </div>



          <div class="method-source-code" id="instance_method_already_implemented-3F-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">instance_method_already_implemented?</span>(<span class="ruby-identifier">method_name</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">method_name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;changed&#39;</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">method_name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;changed?&#39;</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-like" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">like</span><span
            class="method-args">(nid , user)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="like-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 825</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">like</span>(<span class="ruby-identifier">nid</span> , <span class="ruby-identifier">user</span>)
   <span class="ruby-comment"># scope like variable outside the transaction</span>
  <span class="ruby-identifier">like</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">count</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># Create the entry if it isn&#39;t already created.</span>
    <span class="ruby-identifier">like</span> = <span class="ruby-constant">NodeSelection</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">uid</span>,
                               <span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">nid</span>).<span class="ruby-identifier">first_or_create</span>
    <span class="ruby-identifier">like</span>.<span class="ruby-identifier">liking</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">node</span> = <span class="ruby-constant">Node</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">nid</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;note&#39;</span>
      <span class="ruby-constant">SubscriptionMailer</span>.<span class="ruby-identifier">notify_note_liked</span>(<span class="ruby-identifier">node</span>, <span class="ruby-identifier">like</span>.<span class="ruby-identifier">user</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">count</span> = <span class="ruby-value">1</span>
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">toggle_like</span>(<span class="ruby-identifier">like</span>.<span class="ruby-identifier">user</span>)
    <span class="ruby-comment"># Save the changes.</span>
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">save!</span>
    <span class="ruby-identifier">like</span>.<span class="ruby-identifier">save!</span>
  <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-new_node" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">new_node</span><span
            class="method-args">(params)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>same as <a href="Node.html#method-c-new_note">::new_note</a> or <a
href="Node.html#method-c-new_wiki">::new_wiki</a> but with arbitrary type –
use for maps, DRY out <a href="Node.html#method-c-new_note">::new_note</a>
and <a href="Node.html#method-c-new_wiki">::new_wiki</a></p>




          <div class="method-source-code" id="new_node-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 609</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_node</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">node</span> = <span class="ruby-constant">Node</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:uid</span>],
                  <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>],
                  <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">valid?</span>
    <span class="ruby-identifier">revision</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">node</span>.<span class="ruby-identifier">save!</span>
      <span class="ruby-identifier">revision</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">new_revision</span>(<span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">id</span>,
                                   <span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:uid</span>],
                                   <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>],
                                   <span class="ruby-identifier">body</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:body</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">save!</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">vid</span> = <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">vid</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">save!</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">false</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">destroy</span> <span class="ruby-comment"># clean up</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  [<span class="ruby-identifier">saved</span>, <span class="ruby-identifier">node</span>, <span class="ruby-identifier">revision</span>]
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-new_note" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">new_note</span><span
            class="method-args">(params)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>handle creating a new note with attached revision and main image this is
kind of egregiously bad… must revise after researching simultaneous
creation of associated records</p>




          <div class="method-source-code" id="new_note-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 544</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_note</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">author</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:uid</span>])
  <span class="ruby-identifier">node</span> = <span class="ruby-constant">Node</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uid</span><span class="ruby-operator">:</span>     <span class="ruby-identifier">author</span>.<span class="ruby-identifier">uid</span>,
                  <span class="ruby-identifier">title</span><span class="ruby-operator">:</span>   <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>],
                  <span class="ruby-identifier">comment</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>,
                  <span class="ruby-identifier">type</span><span class="ruby-operator">:</span>    <span class="ruby-string">&#39;note&#39;</span>)
  <span class="ruby-identifier">node</span>.<span class="ruby-identifier">status</span> = <span class="ruby-value">4</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">first_time_poster</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">valid?</span> <span class="ruby-comment"># is this not triggering title uniqueness validation?</span>
    <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">revision</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">node</span>.<span class="ruby-identifier">save!</span>
      <span class="ruby-identifier">revision</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">new_revision</span>(<span class="ruby-identifier">uid</span><span class="ruby-operator">:</span>   <span class="ruby-identifier">author</span>.<span class="ruby-identifier">uid</span>,
                                   <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>],
                                   <span class="ruby-identifier">body</span><span class="ruby-operator">:</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:body</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">save!</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">vid</span> = <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">vid</span>
        <span class="ruby-comment"># save main image</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:main_image</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:main_image</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>)
          <span class="ruby-identifier">img</span> = <span class="ruby-constant">Image</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:main_image</span>]
          <span class="ruby-identifier">img</span>.<span class="ruby-identifier">nid</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">id</span>
          <span class="ruby-identifier">img</span>.<span class="ruby-identifier">save</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">save!</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">notify</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">false</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  [<span class="ruby-identifier">saved</span>, <span class="ruby-identifier">node</span>, <span class="ruby-identifier">revision</span>]
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-new_wiki" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">new_wiki</span><span
            class="method-args">(params)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="new_wiki-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 580</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_wiki</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">node</span> = <span class="ruby-constant">Node</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:uid</span>],
                  <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>],
                  <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;page&#39;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">valid?</span>
    <span class="ruby-identifier">revision</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">node</span>.<span class="ruby-identifier">save!</span>
      <span class="ruby-identifier">revision</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">new_revision</span>(<span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">id</span>,
                                   <span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:uid</span>],
                                   <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>],
                                   <span class="ruby-identifier">body</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:body</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">save!</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">vid</span> = <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">vid</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">save!</span>
        <span class="ruby-comment"># node.notify # we don&#39;t yet notify of wiki page creations</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">false</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">destroy</span> <span class="ruby-comment"># clean up</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  [<span class="ruby-identifier">saved</span>, <span class="ruby-identifier">node</span>, <span class="ruby-identifier">revision</span>]
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-questions" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">questions</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>all questions</p>




          <div class="method-source-code" id="questions-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 732</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">questions</span>
  <span class="ruby-identifier">questions</span> = <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;note&#39;</span>)
                  .<span class="ruby-identifier">joins</span>(<span class="ruby-value">:tag</span>)
                  .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;term_data.name LIKE ?&#39;</span>, <span class="ruby-string">&#39;question:%&#39;</span>)
                  .<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;node.nid&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-research_notes" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">research_notes</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="research_notes-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 702</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">research_notes</span>
  <span class="ruby-identifier">nids</span> = <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;note&#39;</span>)
             .<span class="ruby-identifier">joins</span>(<span class="ruby-value">:tag</span>)
             .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;term_data.name LIKE ?&#39;</span>, <span class="ruby-string">&#39;question:%&#39;</span>)
             .<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;node.nid&#39;</span>)
             .<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:nid</span>)
  <span class="ruby-identifier">notes</span> = <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;note&#39;</span>)
              .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;node.nid NOT IN (?)&#39;</span>, <span class="ruby-identifier">nids</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-search" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">(query)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 23</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">query</span>)
  <span class="ruby-constant">Revision</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;MATCH(node_revisions.body, node_revisions.title) AGAINST(?)&#39;</span>, <span class="ruby-identifier">query</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-unlike" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">unlike</span><span
            class="method-args">(nid , user)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="unlike-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 848</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">unlike</span>(<span class="ruby-identifier">nid</span> , <span class="ruby-identifier">user</span>)
  <span class="ruby-identifier">like</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">count</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">like</span> = <span class="ruby-constant">NodeSelection</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">uid</span>,
                               <span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">nid</span>).<span class="ruby-identifier">first_or_create</span>
    <span class="ruby-identifier">like</span>.<span class="ruby-identifier">liking</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">count</span> = <span class="ruby-value">-1</span>
    <span class="ruby-identifier">node</span> = <span class="ruby-constant">Node</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">nid</span>)
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">toggle_like</span>(<span class="ruby-identifier">like</span>.<span class="ruby-identifier">user</span>)
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">save!</span>
    <span class="ruby-identifier">like</span>.<span class="ruby-identifier">save!</span>
   <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-upgrades" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">upgrades</span><span
            class="method-args">(tagname)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>so we can call <a
href="Node.html#method-i-upgrades">#upgrades</a>(&#39;balloon-mapping&#39;)</p>




          <div class="method-source-code" id="upgrades-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 772</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">upgrades</span>(<span class="ruby-identifier">tagname</span>)
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;note&#39;</span>)
      .<span class="ruby-identifier">includes</span>(<span class="ruby-value">:revision</span>, <span class="ruby-value">:tag</span>)
      .<span class="ruby-identifier">references</span>(<span class="ruby-value">:term_data</span>)
      .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;term_data.name LIKE ?&#39;</span>, <span class="ruby-node">&quot;upgrade:#{tagname}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-c-weekly_tallies" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">weekly_tallies</span><span
            class="method-args">(type = 'note', span = 52, time = Time.now)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="weekly_tallies-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">weekly_tallies</span>(<span class="ruby-identifier">type</span> = <span class="ruby-string">&#39;note&#39;</span>, <span class="ruby-identifier">span</span> = <span class="ruby-value">52</span>, <span class="ruby-identifier">time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
  <span class="ruby-identifier">weeks</span> = {}
  (<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">span</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">week</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">weeks</span>[<span class="ruby-identifier">span</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">week</span>] = <span class="ruby-constant">Node</span>.<span class="ruby-identifier">select</span>(<span class="ruby-value">:created</span>)
                             .<span class="ruby-identifier">where</span>(<span class="ruby-identifier">type</span><span class="ruby-operator">:</span>    <span class="ruby-identifier">type</span>,
                                    <span class="ruby-identifier">status</span><span class="ruby-operator">:</span>  <span class="ruby-value">1</span>,
                                    <span class="ruby-identifier">created</span><span class="ruby-operator">:</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">week</span>.<span class="ruby-identifier">weeks</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">..</span><span class="ruby-identifier">time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">week</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">weeks</span>.<span class="ruby-identifier">to_i</span>)
                             .<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">weeks</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>


      <div id="method-i-activities" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">activities</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>so we can quickly fetch activities corresponding to this node with
node.activities</p>




          <div class="method-source-code" id="activities-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 741</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activities</span>
  <span class="ruby-comment"># override with a tag like `activities:h2s`</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_power_tag</span>(<span class="ruby-string">&#39;activities&#39;</span>)
    <span class="ruby-identifier">tagname</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">power_tag</span>(<span class="ruby-string">&#39;activities&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">tagname</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">slug_from_path</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">activities</span>(<span class="ruby-identifier">tagname</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-add_barnstar" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">add_barnstar</span><span
            class="method-args">(tagname, giver)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="add_barnstar-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 644</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_barnstar</span>(<span class="ruby-identifier">tagname</span>, <span class="ruby-identifier">giver</span>)
  <span class="ruby-identifier">add_tag</span>(<span class="ruby-identifier">tagname</span>, <span class="ruby-identifier">giver</span>.<span class="ruby-identifier">user</span>)
  <span class="ruby-constant">CommentMailer</span>.<span class="ruby-identifier">notify_barnstar</span>(<span class="ruby-identifier">giver</span>, <span class="ruby-keyword">self</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-add_comment" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">add_comment</span><span
            class="method-args">(params = {})</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <h6 id="method-i-add_comment-label-"><span><a href="#method-i-add_comment-label-">&para;</a> <a href="#top">&uarr;</a></span></h6>

<p>Automated constructors for associated models</p>




          <div class="method-source-code" id="add_comment-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 513</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_comment</span>(<span class="ruby-identifier">params</span> = {})
  <span class="ruby-identifier">thread</span> = <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">comments</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">comments</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">nil?</span>
             <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">next_thread</span>
           <span class="ruby-keyword">else</span>
             <span class="ruby-string">&#39;01/&#39;</span>
           <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">c</span> = <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pid</span><span class="ruby-operator">:</span> <span class="ruby-value">0</span>,
                  <span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">nid</span>,
                  <span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:uid</span>],
                  <span class="ruby-identifier">subject</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>,
                  <span class="ruby-identifier">hostname</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>,
                  <span class="ruby-identifier">comment</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:body</span>],
                  <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">0</span>,
                  <span class="ruby-identifier">format</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>,
                  <span class="ruby-identifier">thread</span><span class="ruby-operator">:</span> <span class="ruby-identifier">thread</span>,
                  <span class="ruby-identifier">timestamp</span><span class="ruby-operator">:</span> <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">c</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-add_tag" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">add_tag</span><span
            class="method-args">(tagname, user)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="add_tag-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 649</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_tag</span>(<span class="ruby-identifier">tagname</span>, <span class="ruby-identifier">user</span>)
  <span class="ruby-identifier">tagname</span> = <span class="ruby-identifier">tagname</span>.<span class="ruby-identifier">downcase</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">has_tag_without_aliasing</span>(<span class="ruby-identifier">tagname</span>)
    <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">tag</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tagname</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">vid</span><span class="ruby-operator">:</span>         <span class="ruby-value">3</span>, <span class="ruby-comment"># vocabulary id; 1</span>
                                                <span class="ruby-identifier">name</span><span class="ruby-operator">:</span>        <span class="ruby-identifier">tagname</span>,
                                                <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>,
                                                <span class="ruby-identifier">weight</span><span class="ruby-operator">:</span>      <span class="ruby-value">0</span>)

    <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>)[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;date&#39;</span>
          <span class="ruby-keyword">begin</span>
            <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">strptime</span>(<span class="ruby-identifier">tag</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>)[<span class="ruby-value">1</span>], <span class="ruby-string">&#39;%m-%d-%Y&#39;</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value">:long</span>)
          <span class="ruby-keyword">rescue</span>
            <span class="ruby-keyword">return</span> [<span class="ruby-keyword">false</span>, <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">destroy</span>]
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">save!</span>
        <span class="ruby-identifier">node_tag</span> = <span class="ruby-constant">NodeTag</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">tid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">id</span>,
                               <span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">uid</span>,
                               <span class="ruby-identifier">date</span><span class="ruby-operator">:</span> <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>,
                               <span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">id</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">node_tag</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-constant">SubscriptionMailer</span>.<span class="ruby-identifier">notify_tag_added</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">tag</span>, <span class="ruby-identifier">user</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">subscriptions</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">saved</span> = <span class="ruby-keyword">false</span>
          <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">destroy</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-identifier">saved</span>, <span class="ruby-identifier">tag</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-answered" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">answered</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="answered-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">answered</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">answers</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">answers</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-author" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">author</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="author-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 207</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">author</span>
  <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">uid</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-authors" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">authors</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>for wikis:</p>




          <div class="method-source-code" id="authors-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">authors</span>
  <span class="ruby-identifier">revisions</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:author</span>).<span class="ruby-identifier">uniq</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-barnstar" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">barnstar</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="barnstar-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 636</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">barnstar</span>
  <span class="ruby-identifier">power_tag_objects</span>(<span class="ruby-string">&#39;barnstar&#39;</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-barnstars" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">barnstars</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="barnstars-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 640</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">barnstars</span>
  <span class="ruby-identifier">power_tag_objects</span>(<span class="ruby-string">&#39;barnstar&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-body" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">body</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="body-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">body</span>
  <span class="ruby-identifier">latest</span>.<span class="ruby-identifier">body</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">latest</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-body_preview" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">body_preview</span><span
            class="method-args">(length = 100)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="body_preview-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 712</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">body_preview</span>(<span class="ruby-identifier">length</span> = <span class="ruby-value">100</span>)
  <span class="ruby-identifier">try</span>(<span class="ruby-value">:latest</span>).<span class="ruby-identifier">body_preview</span>(<span class="ruby-identifier">length</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-can_tag" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">can_tag</span><span
            class="method-args">(tagname, user, errors = false)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="can_tag-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 779</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_tag</span>(<span class="ruby-identifier">tagname</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">errors</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tagname</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;with:&#39;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_username_case_insensitive</span>(<span class="ruby-identifier">tagname</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>)[<span class="ruby-value">1</span>]).<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">errors</span> <span class="ruby-operator">?</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;node.cannot_find_username&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">uid</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">uid</span>
      <span class="ruby-identifier">errors</span> <span class="ruby-operator">?</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;node.only_author_use_powertag&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">tagname</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>)[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">username</span>
      <span class="ruby-identifier">errors</span> <span class="ruby-operator">?</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;node.cannot_add_yourself_coauthor&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">tagname</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;rsvp:&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">username</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">tagname</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>)[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">errors</span> <span class="ruby-operator">?</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;node.only_RSVP_for_yourself&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">tagname</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;locked&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">role</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;admin&#39;</span>
    <span class="ruby-identifier">errors</span> <span class="ruby-operator">?</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;node.only_admins_can_lock&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">tagname</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>)[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;redirect&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">slug</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tagname</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>)[<span class="ruby-value">1</span>]).<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">errors</span> <span class="ruby-operator">?</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;node.page_does_not_exist&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-coauthors" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">coauthors</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="coauthors-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 211</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">coauthors</span>
  <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">username</span><span class="ruby-operator">:</span> <span class="ruby-identifier">power_tags</span>(<span class="ruby-string">&#39;with&#39;</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_power_tag</span>(<span class="ruby-string">&#39;with&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-comment_count" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">comment_count</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="comment_count-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 202</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">comment_count</span>
  <span class="ruby-identifier">comments</span>
    .<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-created_at" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">created_at</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="created_at-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 236</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">created_at</span>
  <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">created</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-drupal_content_field_image_gallery" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">drupal_content_field_image_gallery</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>was unable to set up this relationship properly with <a
href="ActiveRecord.html">ActiveRecord</a> associations</p>




          <div class="method-source-code" id="drupal_content_field_image_gallery-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 269</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">drupal_content_field_image_gallery</span>
  <span class="ruby-constant">DrupalContentFieldImageGallery</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">nid</span>)
                                .<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;field_image_gallery_fid&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-drupal_main_image" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">drupal_main_image</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>was unable to set up this relationship properly with <a
href="ActiveRecord.html">ActiveRecord</a> associations</p>




          <div class="method-source-code" id="drupal_main_image-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 249</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">drupal_main_image</span>
  <span class="ruby-constant">DrupalMainImage</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;vid&#39;</span>)
                 .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;nid = ? AND field_main_image_fid IS NOT NULL&#39;</span>, <span class="ruby-identifier">nid</span>)
                 .<span class="ruby-identifier">last</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-edit_path" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">edit_path</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="edit_path-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 453</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_path</span>
  <span class="ruby-identifier">path</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;page&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tool&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;place&#39;</span>
           <span class="ruby-string">&#39;/wiki/edit/&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>).<span class="ruby-identifier">last</span>
         <span class="ruby-keyword">else</span>
           <span class="ruby-string">&#39;/notes/edit/&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
         <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">path</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-files" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">files</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="files-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 164</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">files</span>
  <span class="ruby-identifier">drupal_files</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-gallery" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">gallery</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="gallery-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 274</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gallery</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">drupal_content_field_image_gallery</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">drupal_content_field_image_gallery</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">field_image_gallery_fid</span>
    <span class="ruby-identifier">drupal_content_field_image_gallery</span>
  <span class="ruby-keyword">else</span>
    []
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-generate_path" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">generate_path</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>should only be run at actual creation time – or, we should refactor to us
node.created instead of Time.now</p>




          <div class="method-source-code" id="generate_path-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">generate_path</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;note&#39;</span>
    <span class="ruby-identifier">username</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">uid</span>).<span class="ruby-identifier">name</span>
    <span class="ruby-node">&quot;/notes/#{username}/#{Time.now.strftime(&#39;%m-%d-%Y&#39;)}/#{title.parameterize}&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;page&#39;</span>
    <span class="ruby-string">&#39;/wiki/&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">parameterize</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;map&#39;</span>
    <span class="ruby-node">&quot;/map/#{title.parameterize}/#{Time.now.strftime(&#39;%m-%d-%Y&#39;)}&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;feature&#39;</span>
    <span class="ruby-node">&quot;/feature/#{title.parameterize}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-get_matching_tags_without_aliasing" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">get_matching_tags_without_aliasing</span><span
            class="method-args">(tagname)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>can return multiple <a href="Tag.html">Tag</a> records – we don&#39;t yet
hard-enforce uniqueness, but should soon then, this would just be replaced
by Tag.where(name: tagname).first</p>




          <div class="method-source-code" id="get_matching_tags_without_aliasing-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 389</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_matching_tags_without_aliasing</span>(<span class="ruby-identifier">tagname</span>)
  <span class="ruby-identifier">tags</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:node_tag</span>)
            .<span class="ruby-identifier">references</span>(<span class="ruby-value">:community_tags</span>)
            .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;community_tags.nid = ? AND name LIKE ?&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tagname</span>)
  <span class="ruby-comment"># search for tags which end in wildcards</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tagname</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;*&#39;</span>
    <span class="ruby-identifier">tags</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:node_tag</span>)
               .<span class="ruby-identifier">references</span>(<span class="ruby-value">:community_tags</span>)
               .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;community_tags.nid = ? AND (name LIKE ? OR name LIKE ?)&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tagname</span>, <span class="ruby-identifier">tagname</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-string">&#39;*&#39;</span>, <span class="ruby-string">&#39;%&#39;</span>))
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">tags</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-has_accepted_answers" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">has_accepted_answers</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="has_accepted_answers-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 172</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_accepted_answers</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">answers</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">accepted</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-has_mailing_list-3F" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">has_mailing_list?</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <h6 id="method-i-has_mailing_list-3F-label-"><span><a href="#method-i-has_mailing_list-3F-label-">&para;</a> <a href="#top">&uarr;</a></span></h6>

<p>Tag-related methods</p>




          <div class="method-source-code" id="has_mailing_list-3F-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 285</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_mailing_list?</span>
  <span class="ruby-identifier">has_power_tag</span>(<span class="ruby-string">&#39;list&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-has_power_tag" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">has_power_tag</span><span
            class="method-args">(key)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>power tags have “key:value” format, and should be searched with a “key:*”
wildcard</p>




          <div class="method-source-code" id="has_power_tag-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 312</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_power_tag</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-identifier">tids</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:node_tag</span>)
            .<span class="ruby-identifier">references</span>(<span class="ruby-value">:community_tags</span>)
            .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;community_tags.nid = ? AND name LIKE ?&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">key</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;:%&#39;</span>)
            .<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:tid</span>)
  <span class="ruby-operator">!</span><span class="ruby-constant">NodeTag</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;nid = ? AND tid IN (?)&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tids</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-has_tag" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">has_tag</span><span
            class="method-args">(tagname)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>accests a tagname /or/ tagname ending in wildcard such as “tagnam*” also
searches for other tags whose parent field matches given tagname, but not
tags matching given tag&#39;s parent field</p>




          <div class="method-source-code" id="has_tag-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 370</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_tag</span>(<span class="ruby-identifier">tagname</span>)
  <span class="ruby-identifier">tags</span> = <span class="ruby-identifier">get_matching_tags_without_aliasing</span>(<span class="ruby-identifier">tagname</span>)
  <span class="ruby-comment"># search for tags with parent matching this</span>
  <span class="ruby-identifier">tags</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:node_tag</span>)
             .<span class="ruby-identifier">references</span>(<span class="ruby-value">:community_tags</span>)
             .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;community_tags.nid = ? AND parent LIKE ?&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tagname</span>)
  <span class="ruby-comment"># search for parent tag of this, if exists</span>
  <span class="ruby-comment"># tag = Tag.where(name: tagname).try(:first)</span>
  <span class="ruby-comment"># if tag &amp;&amp; tag.parent</span>
  <span class="ruby-comment">#  tags += Tag.includes(:node_tag)</span>
  <span class="ruby-comment">#             .references(:community_tags)</span>
  <span class="ruby-comment">#             .where(&quot;community_tags.nid = ? AND name LIKE ?&quot;, self.id, tag.parent)</span>
  <span class="ruby-comment"># end</span>
  <span class="ruby-identifier">tids</span> = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:tid</span>).<span class="ruby-identifier">uniq</span>
  <span class="ruby-operator">!</span><span class="ruby-constant">NodeTag</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;nid IN (?) AND tid IN (?)&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tids</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-has_tag_without_aliasing" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">has_tag_without_aliasing</span><span
            class="method-args">(tagname)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="has_tag_without_aliasing-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_tag_without_aliasing</span>(<span class="ruby-identifier">tagname</span>)
  <span class="ruby-identifier">tags</span> = <span class="ruby-identifier">get_matching_tags_without_aliasing</span>(<span class="ruby-identifier">tagname</span>)
  <span class="ruby-identifier">tids</span> = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:tid</span>).<span class="ruby-identifier">uniq</span>
  <span class="ruby-operator">!</span><span class="ruby-constant">NodeTag</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;nid IN (?) AND tid IN (?)&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tids</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-icon" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">icon</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>used in typeahead autocomplete search results</p>




          <div class="method-source-code" id="icon-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 420</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">icon</span>
  <span class="ruby-identifier">icon</span> = <span class="ruby-string">&#39;file&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;note&#39;</span>
  <span class="ruby-identifier">icon</span> = <span class="ruby-string">&#39;book&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;page&#39;</span>
  <span class="ruby-identifier">icon</span> = <span class="ruby-string">&#39;map-marker&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;map&#39;</span>
  <span class="ruby-identifier">icon</span> = <span class="ruby-string">&#39;flag&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_tag</span>(<span class="ruby-string">&#39;chapter&#39;</span>)
  <span class="ruby-identifier">icon</span> = <span class="ruby-string">&#39;wrench&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tool&#39;</span>
  <span class="ruby-identifier">icon</span> = <span class="ruby-string">&#39;question-circle&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_power_tag</span>(<span class="ruby-string">&#39;question&#39;</span>)
  <span class="ruby-identifier">icon</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-id" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">id</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>view adaptors for typical rails db conventions so we can migrate someday</p>




          <div class="method-source-code" id="id-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 232</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">id</span>
  <span class="ruby-identifier">nid</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-is_liked_by" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">is_liked_by</span><span
            class="method-args">(user)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="is_liked_by-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 812</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_liked_by</span>(<span class="ruby-identifier">user</span>)
   <span class="ruby-operator">!</span><span class="ruby-constant">NodeSelection</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">uid</span>, <span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> , <span class="ruby-identifier">liking</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-lat" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">lat</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="lat-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 472</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">lat</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_power_tag</span>(<span class="ruby-string">&#39;lat&#39;</span>)
    <span class="ruby-identifier">power_tag</span>(<span class="ruby-string">&#39;lat&#39;</span>).<span class="ruby-identifier">to_f</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-latest" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">latest</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="latest-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 186</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">latest</span>
  <span class="ruby-identifier">revisions</span>
    .<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
    .<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-likers" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">likers</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>users who like this node</p>




          <div class="method-source-code" id="likers-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">likers</span>
  <span class="ruby-identifier">node_selections</span>
    .<span class="ruby-identifier">joins</span>(<span class="ruby-value">:user</span>)
    .<span class="ruby-identifier">references</span>(<span class="ruby-value">:users</span>)
    .<span class="ruby-identifier">where</span>(<span class="ruby-identifier">liking</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
    .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;users.status = ?&#39;</span>, <span class="ruby-value">1</span>)
    .<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:user</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-lon" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">lon</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="lon-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 480</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">lon</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_power_tag</span>(<span class="ruby-string">&#39;lon&#39;</span>)
    <span class="ruby-identifier">power_tag</span>(<span class="ruby-string">&#39;lon&#39;</span>).<span class="ruby-identifier">to_f</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-mailing_list" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">mailing_list</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>has it been tagged with “list:foo” where “foo” is the name of a Google
Group?</p>




          <div class="method-source-code" id="mailing_list-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 409</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mailing_list</span>
  <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">cache</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;feed-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;-&#39;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">updated_at</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">/</span> <span class="ruby-value">300</span>).<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-constant">RSS</span><span class="ruby-operator">::</span><span class="ruby-constant">Parser</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">open</span>(<span class="ruby-string">&#39;https://groups.google.com/group/&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">power_tag</span>(<span class="ruby-string">&#39;list&#39;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/feed/rss_v2_0_topics.xml&#39;</span>).<span class="ruby-identifier">read</span>, <span class="ruby-keyword">false</span>).<span class="ruby-identifier">items</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span>
  <span class="ruby-keyword">return</span> []
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-main_image" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">main_image</span><span
            class="method-args">(node_type = :all)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>provide either a Drupally <a
href="Node.html#method-i-main_image">#main_image</a> or a Railsy one</p>




          <div class="method-source-code" id="main_image-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 256</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">main_image</span>(<span class="ruby-identifier">node_type</span> = <span class="ruby-value">:all</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">images</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">node_type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:drupal</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">main_image_id</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">images</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;vid&#39;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">images</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">main_image_id</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">drupal_main_image</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">node_type</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:rails</span>
    <span class="ruby-identifier">drupal_main_image</span>.<span class="ruby-identifier">drupal_file</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-map" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">map</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="map-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 466</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">map</span>
  <span class="ruby-comment"># This fires off a query that orders by vid DESC</span>
  <span class="ruby-comment"># and is quicker than doing .order(vid: :DESC) for some reason.</span>
  <span class="ruby-identifier">drupal_content_type_map</span>.<span class="ruby-identifier">last</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-mentioned_users" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">mentioned_users</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="mentioned_users-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 685</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mentioned_users</span>
  <span class="ruby-identifier">usernames</span> = <span class="ruby-identifier">body</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">Callouts</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-value">:FINDER</span>))
  <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">username</span><span class="ruby-operator">:</span> <span class="ruby-identifier">usernames</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>] }).<span class="ruby-identifier">uniq</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-new_revision" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">new_revision</span><span
            class="method-args">(params)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="new_revision-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 533</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new_revision</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">title</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:title</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span>
  <span class="ruby-constant">Revision</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">id</span>,
               <span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:uid</span>],
               <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">title</span>,
               <span class="ruby-identifier">body</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:body</span>])
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-next_by_author" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">next_by_author</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="next_by_author-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 498</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">next_by_author</span>
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;uid = ? and nid &gt; ? and type = &quot;note&quot;&#39;</span>, <span class="ruby-identifier">author</span>.<span class="ruby-identifier">uid</span>, <span class="ruby-identifier">nid</span>)
      .<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;nid&#39;</span>)
      .<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-node_tags" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">node_tags</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="node_tags-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 434</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">node_tags</span>
  <span class="ruby-identifier">node_tag</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-normal_tags" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">normal_tags</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>return whole community_tag objects but no powertags or “event”</p>




          <div class="method-source-code" id="normal_tags-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 359</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">normal_tags</span>
  <span class="ruby-identifier">tids</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:node_tag</span>)
            .<span class="ruby-identifier">references</span>(<span class="ruby-value">:community_tags</span>)
            .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;community_tags.nid = ? AND name LIKE ?&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-string">&#39;%:%&#39;</span>)
            .<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:tid</span>)
  <span class="ruby-constant">NodeTag</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;nid = ? AND tid NOT IN (?)&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tids</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-notify" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">notify</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="notify-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 144</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notify</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
    <span class="ruby-constant">AdminMailer</span>.<span class="ruby-identifier">notify_node_moderators</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">SubscriptionMailer</span>.<span class="ruby-identifier">notify_node_creation</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-path" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">path</span><span
            class="method-args">(type = :default)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>can switch to a “question-style” path if specified</p>




          <div class="method-source-code" id="path-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 80</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">path</span>(<span class="ruby-identifier">type</span> = <span class="ruby-value">:default</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:question</span>
    <span class="ruby-keyword">self</span>[<span class="ruby-value">:path</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;/notes/&#39;</span>, <span class="ruby-string">&#39;/questions/&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># default path</span>
    <span class="ruby-keyword">self</span>[<span class="ruby-value">:path</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-power_tag" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">power_tag</span><span
            class="method-args">(tag)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>returns the value for the most recent power tag of form key:value</p>




          <div class="method-source-code" id="power_tag-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 321</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">power_tag</span>(<span class="ruby-identifier">tag</span>)
  <span class="ruby-identifier">tids</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:node_tag</span>)
            .<span class="ruby-identifier">references</span>(<span class="ruby-value">:community_tags</span>)
            .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;community_tags.nid = ? AND name LIKE ?&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tag</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;:%&#39;</span>)
            .<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:tid</span>)
  <span class="ruby-identifier">node_tag</span> = <span class="ruby-constant">NodeTag</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;nid = ? AND tid IN (?)&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tids</span>)
                                   .<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;nid DESC&#39;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">node_tag</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">node_tag</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">node_tag</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">tag</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">tag</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;:&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-power_tag_objects" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">power_tag_objects</span><span
            class="method-args">(tag)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>returns all power tag results as whole community_tag objects</p>




          <div class="method-source-code" id="power_tag_objects-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 350</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">power_tag_objects</span>(<span class="ruby-identifier">tag</span>)
  <span class="ruby-identifier">tids</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:node_tag</span>)
            .<span class="ruby-identifier">references</span>(<span class="ruby-value">:community_tags</span>)
            .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;community_tags.nid = ? AND name LIKE ?&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tag</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;:%&#39;</span>)
            .<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:tid</span>)
  <span class="ruby-constant">NodeTag</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;nid = ? AND tid IN (?)&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tids</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-power_tags" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">power_tags</span><span
            class="method-args">(tag)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>returns all tagnames for a given power tag</p>




          <div class="method-source-code" id="power_tags-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 336</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">power_tags</span>(<span class="ruby-identifier">tag</span>)
  <span class="ruby-identifier">tids</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:node_tag</span>)
            .<span class="ruby-identifier">references</span>(<span class="ruby-value">:community_tags</span>)
            .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;community_tags.nid = ? AND name LIKE ?&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tag</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;:%&#39;</span>)
            .<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:tid</span>)
  <span class="ruby-identifier">node_tags</span> = <span class="ruby-constant">NodeTag</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;nid = ? AND tid IN (?)&#39;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">tids</span>)
  <span class="ruby-identifier">tags</span> = []
  <span class="ruby-identifier">node_tags</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">nt</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">tags</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">nt</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">tag</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;:&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">tags</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-prev_by_author" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">prev_by_author</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="prev_by_author-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 504</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prev_by_author</span>
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;uid = ? and nid &lt; ? and type = &quot;note&quot;&#39;</span>, <span class="ruby-identifier">author</span>.<span class="ruby-identifier">uid</span>, <span class="ruby-identifier">nid</span>)
      .<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;nid desc&#39;</span>)
      .<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-publish" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">publish</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="publish-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 152</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">publish</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-value">1</span>
  <span class="ruby-identifier">save</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-questions" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">questions</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>so we can quickly fetch questions corresponding to this node with
node.questions</p>




          <div class="method-source-code" id="questions-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 718</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">questions</span>
  <span class="ruby-comment"># override with a tag like `questions:h2s`</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_power_tag</span>(<span class="ruby-string">&#39;questions&#39;</span>)
    <span class="ruby-identifier">tagname</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">power_tag</span>(<span class="ruby-string">&#39;questions&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">tagname</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">slug_from_path</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;note&#39;</span>)
      .<span class="ruby-identifier">includes</span>(<span class="ruby-value">:revision</span>, <span class="ruby-value">:tag</span>)
      .<span class="ruby-identifier">references</span>(<span class="ruby-value">:term_data</span>)
      .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;term_data.name LIKE ?&#39;</span>, <span class="ruby-node">&quot;question:#{tagname}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-replace" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">replace</span><span
            class="method-args">(before, after, user)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="replace-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 801</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">replace</span>(<span class="ruby-identifier">before</span>, <span class="ruby-identifier">after</span>, <span class="ruby-identifier">user</span>)
  <span class="ruby-identifier">matches</span> = <span class="ruby-identifier">latest</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">before</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">revision</span> = <span class="ruby-identifier">new_revision</span>(<span class="ruby-identifier">uid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>,
                            <span class="ruby-identifier">body</span><span class="ruby-operator">:</span> <span class="ruby-identifier">latest</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">before</span>, <span class="ruby-identifier">after</span>))
    <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-responded_to" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">responded_to</span><span
            class="method-args">(key = 'response')</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>Nodes this node is responding to with a `response:&lt;nid&gt;` power tag;
The key word “response” can be customized, i.e. `replication:&lt;nid&gt;`
for other uses.</p>




          <div class="method-source-code" id="responded_to-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 291</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">responded_to</span>(<span class="ruby-identifier">key</span> = <span class="ruby-string">&#39;response&#39;</span>)
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">power_tags</span>(<span class="ruby-identifier">key</span>)) <span class="ruby-operator">||</span> []
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-response_count" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">response_count</span><span
            class="method-args">(key = 'response')</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>Nodes that respond to this node with a `response:&lt;nid&gt;` power tag;
The key word “response” can be customized, i.e. `replication:&lt;nid&gt;`
for other uses.</p>




          <div class="method-source-code" id="response_count-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 303</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">response_count</span>(<span class="ruby-identifier">key</span> = <span class="ruby-string">&#39;response&#39;</span>)
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;note&#39;</span>)
      .<span class="ruby-identifier">includes</span>(<span class="ruby-value">:revision</span>, <span class="ruby-value">:tag</span>)
      .<span class="ruby-identifier">references</span>(<span class="ruby-value">:term_data</span>)
      .<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;term_data.name = ?&#39;</span>, <span class="ruby-node">&quot;#{key}:#{id}&quot;</span>)
      .<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-responses" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">responses</span><span
            class="method-args">(key = 'response')</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>Nodes that respond to this node with a `response:&lt;nid&gt;` power tag;
The key word “response” can be customized, i.e. `replication:&lt;nid&gt;`
for other uses.</p>




          <div class="method-source-code" id="responses-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 297</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">responses</span>(<span class="ruby-identifier">key</span> = <span class="ruby-string">&#39;response&#39;</span>)
  <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find_nodes_by_type</span>([<span class="ruby-identifier">key</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;:&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>])
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-revision_count" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">revision_count</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="revision_count-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">revision_count</span>
  <span class="ruby-identifier">revision</span>
    .<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-revisions" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">revisions</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="revisions-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 192</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">revisions</span>
  <span class="ruby-identifier">revision</span>
    .<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;timestamp DESC&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-slug_from_path" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">slug_from_path</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="slug_from_path-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">slug_from_path</span>
  <span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>).<span class="ruby-identifier">last</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-spam" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">spam</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="spam-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 158</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">spam</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">save</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-subscribers" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">subscribers</span><span
            class="method-args">(conditions = false)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>tag- and node-based followers</p>




          <div class="method-source-code" id="subscribers-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">subscribers</span>(<span class="ruby-identifier">conditions</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">users</span> = <span class="ruby-constant">TagSelection</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">tid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:tid</span>))
                      .<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:user</span>)
  <span class="ruby-identifier">users</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">NodeSelection</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">nid</span>)
                        .<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:user</span>)

  <span class="ruby-identifier">users</span> = <span class="ruby-identifier">users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">conditions</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">conditions</span>
  <span class="ruby-identifier">users</span>.<span class="ruby-identifier">uniq</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-tagged_lat" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">tagged_lat</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>these should eventually displace the above means of finding locations …they
may already be redundant after tagged_map_coord migration</p>




          <div class="method-source-code" id="tagged_lat-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 490</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tagged_lat</span>
  <span class="ruby-identifier">power_tags</span>(<span class="ruby-string">&#39;lat&#39;</span>)[<span class="ruby-value">0</span>]
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-tagged_lon" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">tagged_lon</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="tagged_lon-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 494</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tagged_lon</span>
  <span class="ruby-identifier">power_tags</span>(<span class="ruby-string">&#39;lon&#39;</span>)[<span class="ruby-value">0</span>]
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-tagnames" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">tagnames</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="tagnames-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 438</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tagnames</span>
  <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:name</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-tagnames_as_classes" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">tagnames_as_classes</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>Here we re-query to fetch /all/ tagnames; this is used in
/views/notes/_notes.html.erb in a way that would otherwise only return a
single tag due to a join, yet select() keeps this efficient</p>




          <div class="method-source-code" id="tagnames_as_classes-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 445</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tagnames_as_classes</span>
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">select</span>([<span class="ruby-value">:nid</span>])
      .<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>)
      .<span class="ruby-identifier">tagnames</span>
      .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-string">&#39;tag-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-string">&#39;:&#39;</span>, <span class="ruby-string">&#39;-&#39;</span>) }
      .<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-tags" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">tags</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="tags-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 430</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tags</span>
  <span class="ruby-identifier">tag</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-toggle_like" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">toggle_like</span><span
            class="method-args">(user)</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="toggle_like-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 816</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">toggle_like</span>(<span class="ruby-identifier">user</span>)
  <span class="ruby-identifier">nodes</span> = <span class="ruby-constant">NodeSelection</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">nid</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> , <span class="ruby-identifier">liking</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_liked_by</span>(<span class="ruby-identifier">user</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cached_likes</span> = <span class="ruby-identifier">nodes</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cached_likes</span> = <span class="ruby-identifier">nodes</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-totalviews" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">totalviews</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="totalviews-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 126</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">totalviews</span>
  <span class="ruby-comment"># disabled as impressionist is not currently updating counter_cache; see above</span>
  <span class="ruby-comment"># self.views + self.legacy_views</span>
  <span class="ruby-identifier">impressionist_count</span>(<span class="ruby-identifier">filter</span><span class="ruby-operator">:</span> <span class="ruby-value">:ip_address</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">legacy_views</span>
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-updated_at" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">updated_at</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="updated_at-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 240</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">updated_at</span>
  <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-keyword">self</span>[<span class="ruby-string">&#39;changed&#39;</span>])
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-updated_month" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">updated_month</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">






          <div class="method-source-code" id="updated_month-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 27</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">updated_month</span>
  <span class="ruby-identifier">updated_at</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%B %Y&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


      <div id="method-i-upgrades" class="method-detail ">

        <div class="method-heading">
          <span class="method-name">upgrades</span><span
            class="method-args">()</span>

          <span class="method-click-advice">click to toggle source</span>

        </div>


        <div class="method-description">

          <p>so we can quickly fetch upgrades corresponding to this node with
node.upgrades</p>




          <div class="method-source-code" id="upgrades-source">
            <pre><span class="ruby-comment"># File app/models/node.rb, line 761</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upgrades</span>
  <span class="ruby-comment"># override with a tag like `upgrades:h2s`</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_power_tag</span>(<span class="ruby-string">&#39;upgrades&#39;</span>)
    <span class="ruby-identifier">tagname</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">power_tag</span>(<span class="ruby-string">&#39;upgrades&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">tagname</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">slug_from_path</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Node</span>.<span class="ruby-identifier">upgrades</span>(<span class="ruby-identifier">tagname</span>)
<span class="ruby-keyword">end</span></pre>
          </div>

        </div>




      </div>


    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>
